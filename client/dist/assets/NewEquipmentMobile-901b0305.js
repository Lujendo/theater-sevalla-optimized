import{u as J,b as P,a as U,r as m,c as y,e as G,j as e,B as q,k as X,l as f,g as Y,h as Z,f as D,d as ee,i as se}from"./index-e28efbec.js";import"./pdf-excel-b0340315.js";const ne=()=>{var M,E,L,B,T,F,I,z,K;const w=J();P();const j=U(),[n,S]=m.useState(1),[r,x]=m.useState({type_id:"",category_id:"",category:"",brand:"",model:"",serial_number:"",location_id:"",location:"",status:"available",quantity:1,description:"",reference_image_id:""}),[Q,re]=m.useState([]),[k,h]=m.useState(""),[$,O]=m.useState(!1),[V,v]=m.useState(!1),{data:p}=y({queryKey:["equipment-types"],queryFn:Y,staleTime:3e5}),{data:l}=y({queryKey:["locations"],queryFn:Z,staleTime:3e5}),{data:o}=y({queryKey:["categories"],queryFn:D,staleTime:3e5}),{data:b}=y({queryKey:["default-storage-locations"],queryFn:async()=>(await ee.get("/api/default-storage-locations")).data,staleTime:3e5});m.useEffect(()=>{var s;if(((s=b==null?void 0:b.defaultStorageLocations)==null?void 0:s.length)>0&&!r.location_id){const t=b.defaultStorageLocations[0];x(a=>{var c;return{...a,location_id:t.location_id.toString(),location:((c=t.location)==null?void 0:c.name)||t.name||"Default Storage",status:"available"}})}},[b,r.location_id]);const N=G({mutationFn:se,onSuccess:s=>{j.invalidateQueries({queryKey:["equipment"]}),j.invalidateQueries({queryKey:["equipment-list"]}),j.invalidateQueries({queryKey:["equipment-summary"]}),O(!0),f.success("Equipment created successfully!",{icon:"ğŸ“±âœ…"}),setTimeout(()=>{w(`/equipment/${s.equipment.id}`)},1500)},onError:s=>{var a,c,g,i;console.error("ğŸ“± Mobile equipment creation error:",s),console.error("ğŸ“± Error response:",JSON.stringify((a=s.response)==null?void 0:a.data,null,2)),console.error("ğŸ“± Error status:",(c=s.response)==null?void 0:c.status),console.error("ğŸ“± Error message:",s.message);const t=((i=(g=s.response)==null?void 0:g.data)==null?void 0:i.message)||s.message||"Failed to create equipment";h(t),f.error(`Failed to create equipment: ${t}`,{icon:"ğŸ“±âŒ"})}}),d=s=>{var c,g;const{name:t,value:a}=s.target;if(console.log(`ğŸ“± Input change: ${t} = "${a}" (type: ${typeof a})`),t==="type_id")console.log("ğŸ“± Type selection:",a),x(i=>({...i,type_id:a}));else if(t==="category_id"){const i=(c=o==null?void 0:o.categories)==null?void 0:c.find(u=>u.id.toString()===a);x(u=>({...u,category_id:a,category:(i==null?void 0:i.name)||""}))}else if(t==="location_id"){const i=(g=l==null?void 0:l.locations)==null?void 0:g.find(u=>u.id.toString()===a);x(u=>({...u,location_id:a,location:(i==null?void 0:i.name)||""}))}else x(i=>({...i,[t]:a}))},W=s=>{x(t=>({...t,serial_number:s})),v(!1),f.success("Barcode scanned successfully!",{icon:"ğŸ“±ğŸ“·"}),n===2&&setTimeout(()=>C(),1e3)},_=s=>{if(s.preventDefault(),console.log("ğŸ“± Mobile form submission data:",JSON.stringify(r,null,2)),console.log("ğŸ“± Type ID:",r.type_id,"Type:",typeof r.type_id),console.log("ğŸ“± Brand:",r.brand),console.log("ğŸ“± Model:",r.model),!r.type_id||r.type_id===""||r.type_id==="0"){console.error("ğŸ“± Validation failed: type_id is",r.type_id),h("Equipment type is required - please select a type");return}if(!r.brand||r.brand.trim()===""){console.error("ğŸ“± Validation failed: brand is",r.brand),h("Brand is required");return}if(!r.model||r.model.trim()===""){console.error("ğŸ“± Validation failed: model is",r.model),h("Model is required");return}const t=parseInt(r.type_id,10);if(isNaN(t)||t<=0){console.error("ğŸ“± Invalid type_id conversion:",r.type_id,"â†’",t),h("Invalid equipment type selected");return}const a={...r,type_id:t};console.log("ğŸ“± Final equipment data being sent:",JSON.stringify(a,null,2)),N.mutate({equipment:a,files:Q,referenceImageFile:null,allocation:null})},A=()=>{w("/equipment")},C=()=>{n<4&&S(n+1)},R=()=>{n>1&&S(n-1)},H=["available","in-use","maintenance","unavailable","broken"];return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:A,className:"p-2 text-gray-600 hover:text-gray-800",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Add Equipment"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("span",{children:["Step ",n," of 4"]}),e.jsxs("span",{children:[Math.round(n/4*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${n/4*100}%`}})})]})]})}),k&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-red-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-red-700",children:k}),e.jsx("button",{onClick:()=>h(""),className:"ml-auto text-red-400 hover:text-red-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),$&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-green-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700",children:"Equipment created! Redirecting..."})]})}),e.jsxs("form",{onSubmit:_,className:"px-4 py-4",children:[n===1&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Equipment Type *"}),e.jsxs("select",{name:"type_id",value:r.type_id,onChange:d,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),(M=p==null?void 0:p.types)==null?void 0:M.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{name:"category_id",value:r.category_id,onChange:d,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Category"}),(E=o==null?void 0:o.categories)==null?void 0:E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand *"}),e.jsx("input",{type:"text",name:"brand",value:r.brand,onChange:d,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter brand",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model *"}),e.jsx("input",{type:"text",name:"model",value:r.model,onChange:d,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter model",required:!0})]})]})}),n===2&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Serial Number (Optional)"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Serial Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"serial_number",value:r.serial_number,onChange:d,className:"w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter or scan serial number (optional)"}),e.jsx("button",{type:"button",onClick:()=>v(!0),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tap the scan icon to use your camera, or skip if no barcode available"})]})]})}),n===3&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Location & Status"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),e.jsxs("select",{name:"location_id",value:r.location_id,onChange:d,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Location"}),(L=l==null?void 0:l.locations)==null?void 0:L.map(s=>e.jsxs("option",{value:s.id,children:[s.name,s.city&&` (${s.city})`]},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{name:"status",value:r.status,onChange:d,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:H.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1).replace("-"," ")},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),e.jsx("input",{type:"number",name:"quantity",min:"1",value:r.quantity,onChange:d,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]})}),n===4&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Description & Review"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:d,rows:"3",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"Review"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",((T=(B=p==null?void 0:p.types)==null?void 0:B.find(s=>s.id.toString()===r.type_id))==null?void 0:T.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Category:"})," ",((I=(F=o==null?void 0:o.categories)==null?void 0:F.find(s=>s.id.toString()===r.category_id))==null?void 0:I.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Brand:"})," ",r.brand||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Model:"})," ",r.model||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Serial:"})," ",r.serial_number||"Not provided"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Location:"})," ",((K=(z=l==null?void 0:l.locations)==null?void 0:z.find(s=>s.id.toString()===r.location_id))==null?void 0:K.name)||"Default Storage"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Quantity:"})," ",r.quantity]})]})]})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{type:"button",variant:"secondary",onClick:R,disabled:n===1,className:"flex-1 mr-2",children:"Previous"}),n<4?e.jsx(q,{type:"button",variant:"primary",onClick:C,className:"flex-1 ml-2",children:"Next"}):e.jsx(q,{type:"submit",variant:"primary",onClick:_,disabled:N.isLoading,className:"flex-1 ml-2",children:N.isLoading?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Equipment"})]})}),e.jsx(X,{isOpen:V,onScan:W,onClose:()=>v(!1),onError:s=>{console.error("Barcode scanner error:",s),f.error("Scanner error: "+s,{icon:"ğŸ“±âŒ"})}})]})};export{ne as default};
//# sourceMappingURL=NewEquipmentMobile-901b0305.js.map
