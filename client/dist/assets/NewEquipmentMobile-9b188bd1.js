import{u as O,b as Q,r as l,c as x,e as V,j as e,B as f,k as $,l as h,g as P,h as U,f as G,d as J,i as X}from"./index-d9acd920.js";import"./pdf-excel-b0340315.js";const ee=()=>{var S,q,C,_,L,M,E,B,T;const v=O();Q();const[a,y]=l.useState(1),[r,b]=l.useState({type_id:"",category_id:"",brand:"",model:"",serial_number:"",location_id:"",location:"",status:"available",quantity:1,description:"",reference_image_id:""}),[F,Y]=l.useState([]),[N,g]=l.useState(""),[z,W]=l.useState(!1),[A,p]=l.useState(!1),{data:i}=x({queryKey:["equipment-types"],queryFn:P,staleTime:3e5}),{data:o}=x({queryKey:["locations"],queryFn:U,staleTime:3e5}),{data:c}=x({queryKey:["categories"],queryFn:G,staleTime:3e5}),{data:m}=x({queryKey:["default-storage-locations"],queryFn:async()=>(await J.get("/api/default-storage-locations")).data,staleTime:3e5});l.useEffect(()=>{var s;if(((s=m==null?void 0:m.defaultStorageLocations)==null?void 0:s.length)>0&&!r.location_id){const t=m.defaultStorageLocations[0];b(d=>{var u;return{...d,location_id:t.location_id.toString(),location:((u=t.location)==null?void 0:u.name)||t.name||"Default Storage",status:"available"}})}},[m,r.location_id]);const j=V({mutationFn:X,onSuccess:s=>{W(!0),h.success("Equipment created successfully!",{icon:"üì±‚úÖ"}),setTimeout(()=>{v(`/equipment/${s.equipment.id}`)},1500)},onError:s=>{var t,d;console.error("Error creating equipment:",s),g(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to create equipment"),h.error("Failed to create equipment")}}),n=s=>{const{name:t,value:d}=s.target;b(u=>({...u,[t]:d}))},I=s=>{b(t=>({...t,serial_number:s})),p(!1),h.success("Barcode scanned successfully!",{icon:"üì±üì∑"}),a===2&&setTimeout(()=>k(),1e3)},w=s=>{if(s.preventDefault(),!r.type_id||!r.brand||!r.model){g("Type, brand, and model are required");return}j.mutate({equipment:r,files:F,referenceImageFile:null,allocation:null})},K=()=>{v("/equipment")},k=()=>{a<4&&y(a+1)},R=()=>{a>1&&y(a-1)},H=["available","in-use","maintenance","unavailable","broken"];return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:K,className:"p-2 text-gray-600 hover:text-gray-800",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Add Equipment"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("span",{children:["Step ",a," of 4"]}),e.jsxs("span",{children:[Math.round(a/4*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${a/4*100}%`}})})]})]})}),N&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-red-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-red-700",children:N}),e.jsx("button",{onClick:()=>g(""),className:"ml-auto text-red-400 hover:text-red-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),z&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-green-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700",children:"Equipment created! Redirecting..."})]})}),e.jsxs("form",{onSubmit:w,className:"px-4 py-4",children:[a===1&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Equipment Type *"}),e.jsxs("select",{name:"type_id",value:r.type_id,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),(S=i==null?void 0:i.types)==null?void 0:S.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{name:"category_id",value:r.category_id,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Category"}),(q=c==null?void 0:c.categories)==null?void 0:q.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand *"}),e.jsx("input",{type:"text",name:"brand",value:r.brand,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter brand",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model *"}),e.jsx("input",{type:"text",name:"model",value:r.model,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter model",required:!0})]})]})}),a===2&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Serial Number (Optional)"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Serial Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"serial_number",value:r.serial_number,onChange:n,className:"w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter or scan serial number (optional)"}),e.jsx("button",{type:"button",onClick:()=>p(!0),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tap the scan icon to use your camera, or skip if no barcode available"})]})]})}),a===3&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Location & Status"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),e.jsxs("select",{name:"location_id",value:r.location_id,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Location"}),(C=o==null?void 0:o.locations)==null?void 0:C.map(s=>e.jsxs("option",{value:s.id,children:[s.name,s.city&&` (${s.city})`]},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{name:"status",value:r.status,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:H.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1).replace("-"," ")},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),e.jsx("input",{type:"number",name:"quantity",min:"1",value:r.quantity,onChange:n,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]})}),a===4&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Description & Review"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:n,rows:"3",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"Review"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",((L=(_=i==null?void 0:i.types)==null?void 0:_.find(s=>s.id.toString()===r.type_id))==null?void 0:L.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Category:"})," ",((E=(M=c==null?void 0:c.categories)==null?void 0:M.find(s=>s.id.toString()===r.category_id))==null?void 0:E.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Brand:"})," ",r.brand||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Model:"})," ",r.model||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Serial:"})," ",r.serial_number||"Not provided"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Location:"})," ",((T=(B=o==null?void 0:o.locations)==null?void 0:B.find(s=>s.id.toString()===r.location_id))==null?void 0:T.name)||"Default Storage"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Quantity:"})," ",r.quantity]})]})]})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{type:"button",variant:"secondary",onClick:R,disabled:a===1,className:"flex-1 mr-2",children:"Previous"}),a<4?e.jsx(f,{type:"button",variant:"primary",onClick:k,className:"flex-1 ml-2",children:"Next"}):e.jsx(f,{type:"submit",variant:"primary",onClick:w,disabled:j.isLoading,className:"flex-1 ml-2",children:j.isLoading?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Equipment"})]})}),e.jsx($,{isOpen:A,onScan:I,onClose:()=>p(!1),onError:s=>{console.error("Barcode scanner error:",s),h.error("Scanner error: "+s,{icon:"üì±‚ùå"})}})]})};export{ee as default};
//# sourceMappingURL=NewEquipmentMobile-9b188bd1.js.map
