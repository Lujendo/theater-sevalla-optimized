import{u as P,b as U,a as G,r as m,c as g,e as J,j as e,B as N,k as X,l as p,g as Y,h as Z,f as D,d as ee,i as se}from"./index-29a0f422.js";import"./pdf-excel-b0340315.js";const ne=()=>{var _,L,M,E,B,T,F,z,K;const w=P();U();const j=G(),[t,S]=m.useState(1),[r,x]=m.useState({type_id:"",category_id:"",category:"",brand:"",model:"",serial_number:"",location_id:"",location:"",status:"available",quantity:1,description:"",reference_image_id:""}),[W,re]=m.useState([]),[k,f]=m.useState(""),[A,I]=m.useState(!1),[R,y]=m.useState(!1),{data:u}=g({queryKey:["equipment-types"],queryFn:Y,staleTime:3e5}),{data:i}=g({queryKey:["locations"],queryFn:Z,staleTime:3e5}),{data:l}=g({queryKey:["categories"],queryFn:D,staleTime:3e5}),{data:h}=g({queryKey:["default-storage-locations"],queryFn:async()=>(await ee.get("/api/default-storage-locations")).data,staleTime:3e5});m.useEffect(()=>{var s;if(((s=h==null?void 0:h.defaultStorageLocations)==null?void 0:s.length)>0&&!r.location_id){const a=h.defaultStorageLocations[0];x(n=>{var b;return{...n,location_id:a.location_id.toString(),location:((b=a.location)==null?void 0:b.name)||a.name||"Default Storage",status:"available"}})}},[h,r.location_id]);const v=J({mutationFn:se,onSuccess:s=>{j.invalidateQueries({queryKey:["equipment"]}),j.invalidateQueries({queryKey:["equipment-list"]}),j.invalidateQueries({queryKey:["equipment-summary"]}),I(!0),p.success("Equipment created successfully!",{icon:"üì±‚úÖ"}),setTimeout(()=>{w(`/equipment/${s.equipment.id}`)},1500)},onError:s=>{var a,n;console.error("Error creating equipment:",s),f(((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to create equipment"),p.error("Failed to create equipment")}}),o=s=>{var b,Q;const{name:a,value:n}=s.target;if(a==="category_id"){const d=(b=l==null?void 0:l.categories)==null?void 0:b.find(c=>c.id.toString()===n);x(c=>({...c,category_id:n,category:(d==null?void 0:d.name)||""}))}else if(a==="location_id"){const d=(Q=i==null?void 0:i.locations)==null?void 0:Q.find(c=>c.id.toString()===n);x(c=>({...c,location_id:n,location:(d==null?void 0:d.name)||""}))}else x(d=>({...d,[a]:n}))},H=s=>{x(a=>({...a,serial_number:s})),y(!1),p.success("Barcode scanned successfully!",{icon:"üì±üì∑"}),t===2&&setTimeout(()=>C(),1e3)},q=s=>{if(s.preventDefault(),!r.type_id||!r.brand||!r.model){f("Type, brand, and model are required");return}v.mutate({equipment:r,files:W,referenceImageFile:null,allocation:null})},O=()=>{w("/equipment")},C=()=>{t<4&&S(t+1)},V=()=>{t>1&&S(t-1)},$=["available","in-use","maintenance","unavailable","broken"];return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:O,className:"p-2 text-gray-600 hover:text-gray-800",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Add Equipment"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("span",{children:["Step ",t," of 4"]}),e.jsxs("span",{children:[Math.round(t/4*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${t/4*100}%`}})})]})]})}),k&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-red-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-red-700",children:k}),e.jsx("button",{onClick:()=>f(""),className:"ml-auto text-red-400 hover:text-red-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),A&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-green-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700",children:"Equipment created! Redirecting..."})]})}),e.jsxs("form",{onSubmit:q,className:"px-4 py-4",children:[t===1&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Equipment Type *"}),e.jsxs("select",{name:"type_id",value:r.type_id,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),(_=u==null?void 0:u.types)==null?void 0:_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{name:"category_id",value:r.category_id,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Category"}),(L=l==null?void 0:l.categories)==null?void 0:L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand *"}),e.jsx("input",{type:"text",name:"brand",value:r.brand,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter brand",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model *"}),e.jsx("input",{type:"text",name:"model",value:r.model,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter model",required:!0})]})]})}),t===2&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Serial Number (Optional)"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Serial Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"serial_number",value:r.serial_number,onChange:o,className:"w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter or scan serial number (optional)"}),e.jsx("button",{type:"button",onClick:()=>y(!0),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tap the scan icon to use your camera, or skip if no barcode available"})]})]})}),t===3&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Location & Status"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),e.jsxs("select",{name:"location_id",value:r.location_id,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Location"}),(M=i==null?void 0:i.locations)==null?void 0:M.map(s=>e.jsxs("option",{value:s.id,children:[s.name,s.city&&` (${s.city})`]},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{name:"status",value:r.status,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:$.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1).replace("-"," ")},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),e.jsx("input",{type:"number",name:"quantity",min:"1",value:r.quantity,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]})}),t===4&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Description & Review"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:o,rows:"3",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"Review"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",((B=(E=u==null?void 0:u.types)==null?void 0:E.find(s=>s.id.toString()===r.type_id))==null?void 0:B.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Category:"})," ",((F=(T=l==null?void 0:l.categories)==null?void 0:T.find(s=>s.id.toString()===r.category_id))==null?void 0:F.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Brand:"})," ",r.brand||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Model:"})," ",r.model||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Serial:"})," ",r.serial_number||"Not provided"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Location:"})," ",((K=(z=i==null?void 0:i.locations)==null?void 0:z.find(s=>s.id.toString()===r.location_id))==null?void 0:K.name)||"Default Storage"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Quantity:"})," ",r.quantity]})]})]})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{type:"button",variant:"secondary",onClick:V,disabled:t===1,className:"flex-1 mr-2",children:"Previous"}),t<4?e.jsx(N,{type:"button",variant:"primary",onClick:C,className:"flex-1 ml-2",children:"Next"}):e.jsx(N,{type:"submit",variant:"primary",onClick:q,disabled:v.isLoading,className:"flex-1 ml-2",children:v.isLoading?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Equipment"})]})}),e.jsx(X,{isOpen:R,onScan:H,onClose:()=>y(!1),onError:s=>{console.error("Barcode scanner error:",s),p.error("Scanner error: "+s,{icon:"üì±‚ùå"})}})]})};export{ne as default};
//# sourceMappingURL=NewEquipmentMobile-e60ccefa.js.map
