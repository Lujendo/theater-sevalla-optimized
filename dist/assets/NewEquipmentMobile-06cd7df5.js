import{u as P,b as U,a as G,r as u,c as p,e as J,j as e,B as w,k as X,l as j,g as Y,h as Z,f as D,d as ee,i as se}from"./index-4a8791fb.js";import"./pdf-excel-b0340315.js";const ne=()=>{var M,E,L,B,T,F,z,K,Q;const q=P();U();const y=G(),[a,S]=u.useState(1),[r,h]=u.useState({type_id:"",category_id:"",category:"",brand:"",model:"",serial_number:"",location_id:"",location:"",status:"available",quantity:1,description:"",reference_image_id:""}),[I,re]=u.useState([]),[k,f]=u.useState(""),[W,A]=u.useState(!1),[R,v]=u.useState(!1),{data:x}=p({queryKey:["equipment-types"],queryFn:Y,staleTime:3e5}),{data:i}=p({queryKey:["locations"],queryFn:Z,staleTime:3e5}),{data:l}=p({queryKey:["categories"],queryFn:D,staleTime:3e5}),{data:b}=p({queryKey:["default-storage-locations"],queryFn:async()=>(await ee.get("/api/default-storage-locations")).data,staleTime:3e5});u.useEffect(()=>{var s;if(((s=b==null?void 0:b.defaultStorageLocations)==null?void 0:s.length)>0&&!r.location_id){const t=b.defaultStorageLocations[0];h(n=>{var c;return{...n,location_id:t.location_id.toString(),location:((c=t.location)==null?void 0:c.name)||t.name||"Default Storage",status:"available"}})}},[b,r.location_id]);const N=J({mutationFn:se,onSuccess:s=>{y.invalidateQueries({queryKey:["equipment"]}),y.invalidateQueries({queryKey:["equipment-list"]}),y.invalidateQueries({queryKey:["equipment-summary"]}),A(!0),j.success("Equipment created successfully!",{icon:"üì±‚úÖ"}),setTimeout(()=>{q(`/equipment/${s.equipment.id}`)},1500)},onError:s=>{var n,c,g;console.error("üì± Mobile equipment creation error:",s),console.error("üì± Error response:",(n=s.response)==null?void 0:n.data),console.error("üì± Error message:",s.message);const t=((g=(c=s.response)==null?void 0:c.data)==null?void 0:g.message)||s.message||"Failed to create equipment";f(t),j.error(`Failed to create equipment: ${t}`,{icon:"üì±‚ùå"})}}),o=s=>{var c,g;const{name:t,value:n}=s.target;if(t==="category_id"){const d=(c=l==null?void 0:l.categories)==null?void 0:c.find(m=>m.id.toString()===n);h(m=>({...m,category_id:n,category:(d==null?void 0:d.name)||""}))}else if(t==="location_id"){const d=(g=i==null?void 0:i.locations)==null?void 0:g.find(m=>m.id.toString()===n);h(m=>({...m,location_id:n,location:(d==null?void 0:d.name)||""}))}else h(d=>({...d,[t]:n}))},$=s=>{h(t=>({...t,serial_number:s})),v(!1),j.success("Barcode scanned successfully!",{icon:"üì±üì∑"}),a===2&&setTimeout(()=>_(),1e3)},C=s=>{if(s.preventDefault(),console.log("üì± Mobile form submission data:",r),console.log("üì± Type ID:",r.type_id,"Type:",typeof r.type_id),console.log("üì± Brand:",r.brand),console.log("üì± Model:",r.model),!r.type_id||!r.brand||!r.model){f("Type, brand, and model are required");return}const t={...r,type_id:parseInt(r.type_id,10)};console.log("üì± Final equipment data being sent:",t),N.mutate({equipment:t,files:I,referenceImageFile:null,allocation:null})},H=()=>{q("/equipment")},_=()=>{a<4&&S(a+1)},O=()=>{a>1&&S(a-1)},V=["available","in-use","maintenance","unavailable","broken"];return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10",children:e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:H,className:"p-2 text-gray-600 hover:text-gray-800",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-800",children:"Add Equipment"}),e.jsx("div",{className:"w-10"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("span",{children:["Step ",a," of 4"]}),e.jsxs("span",{children:[Math.round(a/4*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${a/4*100}%`}})})]})]})}),k&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-red-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-red-700",children:k}),e.jsx("button",{onClick:()=>f(""),className:"ml-auto text-red-400 hover:text-red-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),W&&e.jsx("div",{className:"mx-4 mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 text-green-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm text-green-700",children:"Equipment created! Redirecting..."})]})}),e.jsxs("form",{onSubmit:C,className:"px-4 py-4",children:[a===1&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Equipment Type *"}),e.jsxs("select",{name:"type_id",value:r.type_id,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Type"}),(M=x==null?void 0:x.types)==null?void 0:M.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{name:"category_id",value:r.category_id,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Category"}),(E=l==null?void 0:l.categories)==null?void 0:E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Brand *"}),e.jsx("input",{type:"text",name:"brand",value:r.brand,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter brand",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Model *"}),e.jsx("input",{type:"text",name:"model",value:r.model,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter model",required:!0})]})]})}),a===2&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Serial Number (Optional)"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Serial Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"serial_number",value:r.serial_number,onChange:o,className:"w-full p-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter or scan serial number (optional)"}),e.jsx("button",{type:"button",onClick:()=>v(!0),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tap the scan icon to use your camera, or skip if no barcode available"})]})]})}),a===3&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Location & Status"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),e.jsxs("select",{name:"location_id",value:r.location_id,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select Location"}),(L=i==null?void 0:i.locations)==null?void 0:L.map(s=>e.jsxs("option",{value:s.id,children:[s.name,s.city&&` (${s.city})`]},s.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status *"}),e.jsx("select",{name:"status",value:r.status,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0,children:V.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1).replace("-"," ")},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),e.jsx("input",{type:"number",name:"quantity",min:"1",value:r.quantity,onChange:o,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]})]})}),a===4&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-800 mb-4",children:"Description & Review"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{name:"description",value:r.description,onChange:o,rows:"3",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter description (optional)"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-2",children:"Review"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",((T=(B=x==null?void 0:x.types)==null?void 0:B.find(s=>s.id.toString()===r.type_id))==null?void 0:T.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Category:"})," ",((z=(F=l==null?void 0:l.categories)==null?void 0:F.find(s=>s.id.toString()===r.category_id))==null?void 0:z.name)||"Not selected"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Brand:"})," ",r.brand||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Model:"})," ",r.model||"Not entered"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Serial:"})," ",r.serial_number||"Not provided"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Location:"})," ",((Q=(K=i==null?void 0:i.locations)==null?void 0:K.find(s=>s.id.toString()===r.location_id))==null?void 0:Q.name)||"Default Storage"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",r.status]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Quantity:"})," ",r.quantity]})]})]})]})})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{type:"button",variant:"secondary",onClick:O,disabled:a===1,className:"flex-1 mr-2",children:"Previous"}),a<4?e.jsx(w,{type:"button",variant:"primary",onClick:_,className:"flex-1 ml-2",children:"Next"}):e.jsx(w,{type:"submit",variant:"primary",onClick:C,disabled:N.isLoading,className:"flex-1 ml-2",children:N.isLoading?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Equipment"})]})}),e.jsx(X,{isOpen:R,onScan:$,onClose:()=>v(!1),onError:s=>{console.error("Barcode scanner error:",s),j.error("Scanner error: "+s,{icon:"üì±‚ùå"})}})]})};export{ne as default};
//# sourceMappingURL=NewEquipmentMobile-06cd7df5.js.map
